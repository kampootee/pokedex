<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legends Z-A Pokedex Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }

        /* Strict Grid Setup */
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
        }

        @media (max-width: 1400px) {
            .pokemon-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            .pokemon-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* Interactive Button Styles */
        .track-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 4px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.4);
            user-select: none;
            position: relative;
            z-index: 20;
        }

        .track-btn input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* Active State Highlights */
        .btn-reg:has(input:checked) { background-color: #3b82f6 !important; border-color: #60a5fa !important; color: white !important; box-shadow: 0 0 12px rgba(59, 130, 246, 0.4); }
        .btn-living:has(input:checked) { background-color: #f59e0b !important; border-color: #fbbf24 !important; color: white !important; box-shadow: 0 0 12px rgba(245, 158, 11, 0.4); }
        .btn-alpha:has(input:checked) { background-color: #ef4444 !important; border-color: #f87171 !important; color: white !important; box-shadow: 0 0 12px rgba(239, 68, 68, 0.4); }
        .btn-mega:has(input:checked) { background-color: #10b981 !important; border-color: #34d399 !important; color: white !important; box-shadow: 0 0 12px rgba(16, 185, 129, 0.4); }

        /* Default Text Colors */
        .btn-reg { color: #93c5fd; }
        .btn-living { color: #fcd34d; }
        .btn-alpha { color: #fca5a5; }
        .btn-mega { color: #6ee7b7; }

        .btn-reg:hover, .btn-living:hover, .btn-alpha:hover, .btn-mega:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(0, 0, 0, 0.6);
        }

        .box-card {
            background: #1e293b;
            border: 1px solid #334155;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .sticky-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #1e293b;
        }

        .pkmn-name {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pkmn-cell {
            position: relative;
            overflow: hidden;
            background-size: auto 100% !important; 
            background-repeat: no-repeat !important;
            background-position: calc(100% - 10px) center !important; 
            background-blend-mode: overlay !important;
            transition: transform 0.2s ease;
        }

        /* Type Colors */
        .type-grass { background-color: #064e3b !important; border-color: #065f46 !important; }
        .type-fire { background-color: #7f1d1d !important; border-color: #991b1b !important; }
        .type-water { background-color: #1e3a8a !important; border-color: #1e40af !important; }
        .type-bug { background-color: #365314 !important; border-color: #3f6212 !important; }
        .type-normal { background-color: #334155 !important; border-color: #475569 !important; }
        .type-poison { background-color: #4c1d95 !important; border-color: #5b21b6 !important; }
        .type-electric { background-color: #713f12 !important; border-color: #854d0e !important; }
        .type-ground { background-color: #451a03 !important; border-color: #78350f !important; }
        .type-fairy { background-color: #701a75 !important; border-color: #86198f !important; }
        .type-fighting { background-color: #7c2d12 !important; border-color: #9a3412 !important; }
        .type-psychic { background-color: #831843 !important; border-color: #9d174d !important; }
        .type-rock { background-color: #422006 !important; border-color: #5d2b06 !important; }
        .type-ghost { background-color: #2e1065 !important; border-color: #4c1d95 !important; }
        .type-ice { background-color: #164e63 !important; border-color: #155e75 !important; }
        .type-dragon { background-color: #1e1b4b !important; border-color: #312e81 !important; }
        .type-steel { background-color: #1e293b !important; border-color: #334155 !important; }
        .type-dark { background-color: #475569 !important; border-color: #64748b !important; }
        .type-flying { background-color: #312e81 !important; border-color: #3730a3 !important; }

        #missing-modal { backdrop-filter: blur(8px); }
        .text-shadow { text-shadow: 0 1px 2px rgba(0,0,0,0.8); }

        .box-complete-badge, .pkmn-complete-badge {
            animation: badge-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes badge-in {
            from { transform: scale(0.8) translateY(-5px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <header class="sticky-header sticky top-0 z-50 px-4 py-6 mb-10">
        <div class="max-w-[1700px] mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <div class="flex flex-wrap items-center gap-4">
                    <h1 class="text-3xl font-black bg-gradient-to-r from-blue-400 via-white to-red-500 bg-clip-text text-transparent uppercase tracking-tighter">
                        Legends Z-A Tracker
                    </h1>
                    <a href="https://example.com/dlc1" target="_blank" class="bg-white text-slate-900 px-4 py-1 rounded-xl font-black text-sm uppercase tracking-tighter hover:bg-slate-200 transition-all shadow-lg active:scale-95">
                        DLC1 Pokédex
                    </a>
                </div>
                <div id="save-status" class="text-[10px] font-black uppercase tracking-widest text-slate-500 mt-2 md:mt-0 transition-opacity opacity-0">
                    <span class="inline-block w-2 h-2 rounded-full bg-emerald-500 mr-2"></span>Synced to Browser
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                <div onclick="showMissing('reg')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-blue-500/20 shadow-lg hover:border-blue-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-blue-400 uppercase tracking-widest block mb-0.5">Pokédex</span><span class="text-sm font-bold text-white uppercase tracking-tight">Registered</span></div>
                        <span class="text-xl font-black text-shadow text-blue-400" id="reg-stats">0 / 232</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="reg-bar" class="bg-gradient-to-r from-blue-600 to-blue-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-blue-400/30 group-hover:text-blue-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ➔</div>
                </div>

                <div onclick="showMissing('living')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-amber-500/20 shadow-lg hover:border-amber-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-amber-400 uppercase tracking-widest block mb-0.5">Inventory</span><span class="text-sm font-bold text-white uppercase tracking-tight">Living Dex</span></div>
                        <span class="text-xl font-black text-shadow text-amber-400" id="living-stats">0 / 232</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="living-bar" class="bg-gradient-to-r from-amber-600 to-amber-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-amber-400/30 group-hover:text-amber-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ➔</div>
                </div>

                <div onclick="showMissing('alpha')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-red-500/20 shadow-lg hover:border-red-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-red-400 uppercase tracking-widest block mb-0.5">Specimen</span><span class="text-sm font-bold text-white uppercase tracking-tight">Alpha</span></div>
                        <span class="text-xl font-black text-shadow text-red-400" id="alpha-stats">0 / 232</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="alpha-bar" class="bg-gradient-to-r from-red-600 to-red-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-red-400/30 group-hover:text-red-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ➔</div>
                </div>

                <div onclick="showMissing('mega')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-emerald-500/20 shadow-lg hover:border-emerald-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-emerald-400 uppercase tracking-widest block mb-0.5">Evolution</span><span class="text-sm font-bold text-white uppercase tracking-tight">Mega Forms</span></div>
                        <span class="text-xl font-black text-shadow text-emerald-400" id="mega-stats">0 / 0</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="mega-bar" class="bg-gradient-to-r from-emerald-600 to-emerald-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-emerald-400/30 group-hover:text-emerald-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ➔</div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-[1700px] mx-auto px-6">
        <div id="pokedex-container" class="flex flex-col gap-16 items-center"></div>
        <div class="mt-20 flex flex-col items-center gap-4 text-center">
            <button onclick="resetTracker()" class="px-10 py-4 bg-slate-900 hover:bg-red-600 hover:text-white text-slate-500 border border-slate-800 rounded-2xl transition-all duration-300 text-sm font-black uppercase tracking-widest">
                System Wipe: Clear All Data
            </button>
        </div>
    </main>

    <!-- Missing Items Modal -->
    <div id="missing-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/60">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-2xl max-h-[85vh] rounded-[2.5rem] shadow-2xl flex flex-col overflow-hidden">
            <div class="p-8 border-b border-slate-700 flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl font-black uppercase tracking-tighter italic">Missing Specimens</h2>
                <button onclick="closeModal()" class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-red-600 rounded-full transition-colors font-black">✕</button>
            </div>
            <div id="modal-content" class="p-8 overflow-y-auto grid grid-cols-2 md:grid-cols-3 gap-3"></div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'legends_za_pokedex_persistent_storage';
        const TOTAL_PKMN = 232;
        const PKMN_PER_BOX = 30;
        
        // Legends Z-A Specific Rules
        const NO_ALPHA_IDS = [228, 229, 230, 231, 232]; 

        const POKEMON_NAMES = [
            "Chikorita", "Bayleef", "Meganium", "Tepig", "Pignite", "Emboar", "Totodile", "Croconaw", "Feraligatr", "Fletchling",
            "Fletchinder", "Talonflame", "Bunnelby", "Diggersby", "Scatterbug", "Spewpa", "Vivillon", "Weedle", "Kakuna", "Beedrill",
            "Pidgey", "Pidgeotto", "Pidgeot", "Mareep", "Flaaffy", "Ampharos", "Patrat", "Watchog", "Budew", "Roselia",
            "Roserade", "Magikarp", "Gyarados", "Binacle", "Barbaracle", "Staryu", "Starmie", "Flabébé", "Floette", "Florges",
            "Skiddo", "Gogoat", "Espurr", "Meowstic", "Litleo", "Pyroar", "Pancham", "Pangoro", "Trubbish", "Garbodor",
            "Dedenne", "Pichu", "Pikachu", "Raichu", "Cleffa", "Clefairy", "Clefable", "Spinarak", "Ariados", "Ekans",
            "Arbok", "Abra", "Kadabra", "Alakazam", "Haunter", "Gengar", "Venipede", "Whirlipede", "Scolipede",
            "Honedge", "Doublade", "Aegislash", "Bellsprout", "Weepinbell", "Victreebel", "Pansage", "Simisage", "Pansear", "Simisear",
            "Panpour", "Simipour", "Meditite", "Medicham", "Electrike", "Manectric", "Ralts", "Kirlia", "Gardevoir", "Gallade",
            "Houndour", "Houndoom", "Swablu", "Altaria", "Audino", "Spritzee", "Aromatisse", "Swirlix", "Slurpuff", "Eevee",
            "Vaporeon", "Jolteon", "Flareon", "Espeon", "Umbreon", "Leafeon", "Glaceon", "Sylveon", "Buneary", "Lopunny",
            "Shuppet", "Banette", "Vanillite", "Vanillish", "Vanilluxe", "Numel", "Camerupt", "Hippopotas", "Hippowdon", "Drilbur",
            "Excadrill", "Sandile", "Krokorok", "Krookodile", "Machop", "Machoke", "Machamp", "Gible", "Gabite", "Garchomp",
            "Carbink", "Sableye", "Mawile", "Absol", "Riolu", "Lucario", "Slowpoke", "Slowbro", "Slowking", "Carvanha",
            "Sharpedo", "Tynamo", "Eelektrik", "Eelektross", "Dratini", "Dragonair", "Dragonite", "Bulbasaur", "Ivysaur", "Venusaur",
            "Charmander", "Charmeleon", "Charizard", "Squirtle", "Wartortle", "Blastoise", "Stunfisk", "Furfrou", "Inkay", "Malamar",
            "Skrelp", "Dragalge", "Clauncher", "Clawitzer", "Goomy", "Sliggoo", "Goodra", "Delibird", "Snorunt", "Glalie",
            "Froslass", "Snover", "Abomasnow", "Bergmite", "Avalugg", "Scyther", "Scizor", "Pinsir", "Heracross", "Emolga",
            "Hawlucha", "Phantump", "Trevenant", "Scraggy", "Scrafty", "Noibat", "Noivern", "Klefki", "Litwick", "Lampent",
            "Chandelure", "Aerodactyl", "Tyrunt", "Tyrantrum", "Amaura", "Aurorus", "Onix", "Steelix", "Aron", "Lairon",
            "Aggron", "Helioptile", "Heliolisk", "Pumpkaboo", "Gourgeist", "Larvitar", "Pupitar", "Tyranitar", "Froakie", "Frogadier",
            "Greninja", "Falinks", "Chespin", "Quilladin", "Chesnaught", "Skarmory", "Fennekin", "Braixen", "Delphox", "Bagon",
            "Shelgon", "Salamence", "Kangaskhan", "Drampa", "Beldum", "Metang", "Metagross", "Xerneas", "Yveltal", "Zygarde",
            "Diancie", "Mewtwo"
        ];

        const NATIONAL_IDS = [
            152, 153, 154, 498, 499, 500, 158, 159, 160, 661,
            662, 663, 659, 660, 664, 665, 666, 13, 14, 15,
            16, 17, 18, 179, 180, 181, 504, 505, 406, 315,
            407, 129, 130, 688, 689, 120, 121, 669, 670, 671,
            672, 673, 677, 678, 667, 668, 674, 675, 568, 569,
            702, 172, 25, 26, 173, 35, 36, 167, 168, 23,
            24, 63, 64, 65, 92, 93, 94, 543, 544, 545,
            679, 680, 681, 69, 70, 71, 511, 512, 513, 514,
            515, 516, 307, 308, 309, 310, 280, 281, 282, 475,
            228, 229, 333, 334, 531, 682, 683, 684, 685, 133,
            134, 135, 136, 196, 197, 470, 471, 700, 427, 428,
            353, 354, 582, 583, 584, 322, 323, 449, 450, 529,
            530, 551, 552, 553, 66, 67, 68, 443, 444, 445,
            703, 302, 303, 359, 447, 448, 79, 80, 199, 318,
            319, 602, 603, 604, 147, 148, 149, 1, 2, 3,
            4, 5, 6, 7, 8, 9, 618, 676, 686, 687,
            690, 691, 692, 693, 704, 705, 706, 225, 361, 362,
            478, 459, 460, 712, 713, 123, 212, 127, 214, 587,
            701, 708, 709, 559, 560, 714, 715, 707, 607, 608,
            609, 142, 696, 697, 698, 699, 95, 208, 304, 305,
            306, 694, 695, 710, 711, 246, 247, 248, 656, 657,
            658, 870, 650, 651, 652, 227, 653, 654, 655, 371,
            372, 373, 115, 780, 374, 375, 376, 716, 717, 718,
            719, 150
        ];

        const POKEMON_TYPES = [
            "grass", "grass", "grass", "fire", "fire", "fire", "water", "water", "water", "normal",
            "fire", "fire", "normal", "normal", "bug", "bug", "bug", "bug", "bug", "bug",
            "normal", "normal", "normal", "electric", "electric", "electric", "normal", "normal", "grass", "grass",
            "grass", "water", "water", "rock", "rock", "water", "water", "fairy", "fairy", "fairy",
            "grass", "grass", "psychic", "psychic", "fire", "fire", "fighting", "fighting", "poison", "poison",
            "electric", "electric", "electric", "electric", "fairy", "fairy", "fairy", "bug", "bug", "poison",
            "poison", "psychic", "psychic", "psychic", "ghost", "ghost", "ghost", "bug", "bug", "bug",
            "steel", "steel", "steel", "grass", "grass", "grass", "grass", "grass", "fire", "fire",
            "water", "water", "fighting", "fighting", "electric", "electric", "psychic", "psychic", "psychic", "psychic",
            "dark", "dark", "dragon", "dragon", "normal", "fairy", "fairy", "fairy", "fairy", "normal",
            "water", "electric", "fire", "psychic", "dark", "grass", "ice", "fairy", "normal", "normal",
            "ghost", "ghost", "ice", "ice", "ice", "fire", "fire", "ground", "ground", "ground",
            "ground", "ground", "ground", "ground", "fighting", "fighting", "fighting", "dragon", "dragon", "dragon",
            "rock", "dark", "steel", "dark", "fighting", "fighting", "water", "water", "water", "water",
            "water", "electric", "electric", "electric", "dragon", "dragon", "dragon", "grass", "grass", "grass",
            "fire", "fire", "fire", "water", "water", "water", "ground", "normal", "dark", "dark",
            "poison", "poison", "water", "water", "dragon", "dragon", "dragon", "ice", "ice", "ice",
            "ice", "ice", "ice", "ice", "ice", "bug", "bug", "bug", "bug", "electric",
            "fighting", "ghost", "ghost", "dark", "dark", "dragon", "dragon", "steel", "ghost", "ghost",
            "ghost", "rock", "rock", "rock", "rock", "rock", "rock", "rock", "steel", "steel",
            "steel", "electric", "electric", "ghost", "ghost", "rock", "rock", "rock", "water", "water",
            "water", "fighting", "grass", "grass", "grass", "steel", "fire", "fire", "fire", "dragon",
            "dragon", "dragon", "normal", "normal", "steel", "steel", "steel", "fairy", "dark", "dragon",
            "fairy", "psychic"
        ];

        const MEGA_LIST_NAMES = [
            "Venusaur", "Charizard", "Blastoise", "Alakazam", "Gengar", "Kangaskhan", "Pinsir", "Gyarados", "Aerodactyl", "Mewtwo",
            "Ampharos", "Scizor", "Heracross", "Houndoom", "Tyranitar", "Gardevoir", "Mawile", "Aggron", "Medicham", "Manectric",
            "Banette", "Absol", "Garchomp", "Lucario", "Abomasnow", "Beedrill", "Pidgeot", "Slowbro", "Steelix", "Sableye",
            "Sharpedo", "Camerupt", "Altaria", "Glalie", "Salamence", "Metagross", "Lopunny", "Gallade", "Audino", "Diancie",
            "Clefable", "Victreebel", "Starmie", "Dragonite", "Meganium", "Feraligatr", "Skarmory", "Froslass", "Emboar", "Excadrill",
            "Scolipede", "Scrafty", "Eelektross", "Chandelure", "Chesnaught", "Delphox", "Greninja", "Pyroar", "Floette", "Malamar",
            "Barbaracle", "Dragalge", "Hawlucha", "Zygarde", "Drampa", "Falinks"
        ];

        const MEGA_ELITE = {};
        MEGA_LIST_NAMES.forEach(name => {
            const idx = POKEMON_NAMES.indexOf(name) + 1;
            if (idx > 0) {
                MEGA_ELITE[idx] = (name === "Charizard" || name === "Mewtwo") ? 2 : 1;
            }
        });

        const TOTAL_MEGAS = Object.values(MEGA_ELITE).reduce((a, b) => a + b, 0);

        const container = document.getElementById('pokedex-container');
        const saveStatusEl = document.getElementById('save-status');

        function init() {
            let currentId = 1;
            let boxNum = 1;
            while (currentId <= TOTAL_PKMN) {
                const boxEnd = Math.min(currentId + PKMN_PER_BOX - 1, TOTAL_PKMN);
                createBox(boxNum, currentId, boxEnd);
                currentId += PKMN_PER_BOX;
                boxNum++;
            }
            loadProgress();
            updateStats(false);
        }

        function createBox(number, start, end) {
            const boxCard = document.createElement('div');
            boxCard.className = 'box-card p-8 rounded-[2.5rem] w-full max-w-[1400px] relative overflow-hidden';
            boxCard.id = `box-container-${number}`;
            
            boxCard.innerHTML = `
                <div class="flex items-baseline justify-between mb-8 border-b border-slate-700/50 pb-5">
                    <div class="flex items-baseline gap-4">
                        <span class="bg-white text-slate-900 px-4 py-1 rounded-xl font-black text-sm uppercase tracking-tighter">Box ${number}</span>
                        <span class="text-white font-black text-xl tracking-tight">#${String(start).padStart(3, '0')} — #${String(end).padStart(3, '0')}</span>
                    </div>
                    <div id="box-complete-${number}" class="hidden box-complete-badge bg-emerald-500 text-white px-4 py-1 rounded-xl font-black text-sm uppercase tracking-widest shadow-lg shadow-emerald-500/20">
                        Box Complete!
                    </div>
                </div>
                <div class="pokemon-grid" id="box-grid-${number}"></div>
            `;
            container.appendChild(boxCard);
            const grid = document.getElementById(`box-grid-${number}`);

            for (let i = start; i <= end; i++) {
                const name = POKEMON_NAMES[i - 1];
                const type = POKEMON_TYPES[i - 1];
                const natId = NATIONAL_IDS[i - 1];
                const megaCount = MEGA_ELITE[i] || 0;
                
                const item = document.createElement('div');
                item.id = `pkmn-cell-${i}`;
                item.className = `group pkmn-cell flex flex-col p-4 rounded-2xl border-2 transition-all duration-300 type-${type}`;
                item.style.backgroundImage = `url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${natId}.png')`;

                let megaHtml = '';
                if (megaCount === 1) {
                    megaHtml = `<label class="track-btn btn-mega"><input type="checkbox" id="mega-${i}-0">Mega</label>`;
                } else if (megaCount === 2) {
                    const isDualXY = (name === "Charizard" || name === "Mewtwo");
                    megaHtml = `
                        <label class="track-btn btn-mega"><input type="checkbox" id="mega-${i}-0">${isDualXY ? "Mega X" : "Mega X"}</label>
                        <label class="track-btn btn-mega"><input type="checkbox" id="mega-${i}-1">${isDualXY ? "Mega Y" : "Mega Y"}</label>
                    `;
                }

                let alphaHtml = '';
                if (!NO_ALPHA_IDS.includes(i)) {
                    alphaHtml = `<label class="track-btn btn-alpha"><input type="checkbox" id="alpha-${i}">Alpha</label>`;
                }

                item.innerHTML = `
                    <div class="flex items-center justify-between mb-2 min-h-[24px]">
                        <div class="flex items-baseline gap-2">
                            <span class="text-[10px] font-black text-white/50 tracking-wider text-shadow">#${String(i).padStart(3, '0')}</span>
                            <span class="pkmn-name text-sm font-bold text-white group-hover:scale-105 transition-transform origin-left text-shadow">${name}</span>
                        </div>
                        <div id="pkmn-complete-${i}" class="hidden pkmn-complete-badge bg-emerald-500 text-white w-5 h-5 flex items-center justify-center rounded-full shadow-lg">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 bg-black/40 p-2 rounded-xl border border-white/5 backdrop-blur-sm relative z-10">
                        <label class="track-btn btn-reg"><input type="checkbox" id="reg-${i}">Registered</label>
                        <label class="track-btn btn-living"><input type="checkbox" id="living-${i}">Living</label>
                        ${alphaHtml}
                        ${megaHtml}
                    </div>
                `;
                grid.appendChild(item);
            }
        }

        function showMissing(category) {
            const modal = document.getElementById('missing-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            content.innerHTML = '';
            let missingItems = [];
            let catTitle = category === 'reg' ? "Missing: Registered Dex" : category === 'living' ? "Missing: Living Dex" : category === 'alpha' ? "Missing: Alpha Specimens" : "Missing: Mega Forms";
            title.innerText = catTitle;
            for (let i = 1; i <= TOTAL_PKMN; i++) {
                const name = POKEMON_NAMES[i - 1];
                const type = POKEMON_TYPES[i - 1];
                if (category !== 'mega') {
                    if (category === 'alpha' && NO_ALPHA_IDS.includes(i)) continue;
                    const cb = document.getElementById(`${category}-${i}`);
                    if (cb && !cb.checked) missingItems.push({ id: i, name: name, type: type });
                } else {
                    const megaCount = MEGA_ELITE[i] || 0;
                    if (megaCount === 1) {
                        const cb = document.getElementById(`mega-${i}-0`);
                        if (cb && !cb.checked) missingItems.push({ id: i, name: `Mega ${name}`, type: type });
                    } else if (megaCount === 2) {
                        const cbX = document.getElementById(`mega-${i}-0`);
                        const cbY = document.getElementById(`mega-${i}-1`);
                        if (cbX && !cbX.checked) missingItems.push({ id: i, name: `Mega ${name} X`, type: type });
                        if (cbY && !cbY.checked) missingItems.push({ id: i, name: `Mega ${name} Y`, type: type });
                    }
                }
            }
            if (missingItems.length === 0) {
                content.innerHTML = `<div class="col-span-full py-20 text-center font-black text-emerald-400 uppercase tracking-widest text-xl animate-pulse">Category Complete!</div>`;
            } else {
                missingItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = `p-3 rounded-xl border-2 type-${item.type} bg-opacity-40 flex items-center gap-3`;
                    div.innerHTML = `<span class="text-[10px] font-black text-white/40">#${String(item.id).padStart(3, '0')}</span><span class="text-sm font-bold text-white">${item.name}</span>`;
                    content.appendChild(div);
                });
            }
        }

        function closeModal() { document.getElementById('missing-modal').classList.add('hidden'); }

        function updateStats(showFeedback = true) {
            const r = document.querySelectorAll('.btn-reg input:checked').length;
            const l = document.querySelectorAll('.btn-living input:checked').length;
            const a = document.querySelectorAll('.btn-alpha input:checked').length;
            const m = document.querySelectorAll('.btn-mega input:checked').length;
            const alphaTotal = TOTAL_PKMN - NO_ALPHA_IDS.length;

            document.getElementById('reg-stats').innerText = `${r} / ${TOTAL_PKMN}`;
            document.getElementById('living-stats').innerText = `${l} / ${TOTAL_PKMN}`;
            document.getElementById('alpha-stats').innerText = `${a} / ${alphaTotal}`;
            document.getElementById('mega-stats').innerText = `${m} / ${TOTAL_MEGAS}`;
            
            document.getElementById('reg-bar').style.width = (r/TOTAL_PKMN*100)+'%';
            document.getElementById('living-bar').style.width = (l/TOTAL_PKMN*100)+'%';
            document.getElementById('alpha-bar').style.width = (a/alphaTotal*100)+'%';
            
            const megaPercent = TOTAL_MEGAS > 0 ? (m / TOTAL_MEGAS * 100) : 0;
            document.getElementById('mega-bar').style.width = megaPercent + '%';
            
            for (let i = 1; i <= TOTAL_PKMN; i++) {
                const cell = document.getElementById(`pkmn-cell-${i}`);
                const badge = document.getElementById(`pkmn-complete-${i}`);
                if (cell && badge) {
                    const inputs = cell.querySelectorAll('input');
                    const checked = cell.querySelectorAll('input:checked');
                    if (inputs.length > 0 && inputs.length === checked.length) {
                        badge.classList.remove('hidden');
                        cell.style.borderColor = 'rgba(16, 185, 129, 0.6)';
                    } else {
                        badge.classList.add('hidden');
                        cell.style.borderColor = '';
                    }
                }
            }

            const totalBoxes = Math.ceil(TOTAL_PKMN / PKMN_PER_BOX);
            for (let b = 1; b <= totalBoxes; b++) {
                const boxGrid = document.getElementById(`box-grid-${b}`);
                const badge = document.getElementById(`box-complete-${b}`);
                if (boxGrid && badge) {
                    const inputs = boxGrid.querySelectorAll('input');
                    const checkedInputs = boxGrid.querySelectorAll('input:checked');
                    if (inputs.length > 0 && inputs.length === checkedInputs.length) {
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            }
            saveProgress(showFeedback);
        }

        function saveProgress(showFeedback) {
            const state = {};
            document.querySelectorAll('input[type="checkbox"]').forEach(input => { if (input.checked) state[input.id] = true; });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            if (showFeedback) {
                saveStatusEl.style.opacity = '1';
                setTimeout(() => { saveStatusEl.style.opacity = '0'; }, 1500);
            }
        }

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;
            try {
                const state = JSON.parse(saved);
                Object.keys(state).forEach(id => { const input = document.getElementById(id); if (input) input.checked = true; });
                updateStats(false);
            } catch(e) { console.error("Load failed", e); }
        }

        function resetTracker() {
            if (confirm("SYSTEM OVERRIDE: Clear all saved data?")) {
                localStorage.removeItem(STORAGE_KEY);
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                updateStats(false);
            }
        }

        document.addEventListener('change', (e) => { if (e.target.type === 'checkbox') updateStats(true); });
        window.onclick = function(e) { if (e.target == document.getElementById('missing-modal')) closeModal(); }
        init();
    </script>
</body>
</html>
