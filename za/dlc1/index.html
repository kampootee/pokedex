<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGENDS Z-A: MEGA DIMENSION TRACKER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }

        /* Strict Grid Setup */
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
        }

        @media (max-width: 1400px) {
            .pokemon-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            .pokemon-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* Interactive Button Styles */
        .track-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 4px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.4);
            user-select: none;
            position: relative;
            z-index: 20;
        }

        .track-btn input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* Active State Highlights */
        .btn-reg:has(input:checked) { background-color: #3b82f6 !important; border-color: #60a5fa !important; color: white !important; box-shadow: 0 0 12px rgba(59, 130, 246, 0.4); }
        .btn-living:has(input:checked) { background-color: #f59e0b !important; border-color: #fbbf24 !important; color: white !important; box-shadow: 0 0 12px rgba(245, 158, 11, 0.4); }
        .btn-alpha:has(input:checked) { background-color: #ef4444 !important; border-color: #f87171 !important; color: white !important; box-shadow: 0 0 12px rgba(239, 68, 68, 0.4); }
        .btn-mega:has(input:checked) { background-color: #10b981 !important; border-color: #34d399 !important; color: white !important; box-shadow: 0 0 12px rgba(16, 185, 129, 0.4); }

        /* Default Text Colors */
        .btn-reg { color: #93c5fd; }
        .btn-living { color: #fcd34d; }
        .btn-alpha { color: #fca5a5; }
        .btn-mega { color: #6ee7b7; }

        .btn-reg:hover, .btn-living:hover, .btn-alpha:hover, .btn-mega:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(0, 0, 0, 0.6);
        }

        .box-card {
            background: #1e293b;
            border: 1px solid #334155;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .sticky-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #1e293b;
        }

        .pkmn-name {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pkmn-cell {
            position: relative;
            overflow: hidden;
            background-size: auto 100% !important; 
            background-repeat: no-repeat !important;
            background-position: calc(100% - 10px) center !important; 
            background-blend-mode: overlay !important;
            transition: transform 0.2s ease;
        }

        /* Type Colors */
        .type-grass { background-color: #064e3b !important; border-color: #065f46 !important; }
        .type-fire { background-color: #7f1d1d !important; border-color: #991b1b !important; }
        .type-water { background-color: #1e3a8a !important; border-color: #1e40af !important; }
        .type-bug { background-color: #365314 !important; border-color: #3f6212 !important; }
        .type-normal { background-color: #334155 !important; border-color: #475569 !important; }
        .type-poison { background-color: #4c1d95 !important; border-color: #5b21b6 !important; }
        .type-electric { background-color: #713f12 !important; border-color: #854d0e !important; }
        .type-ground { background-color: #451a03 !important; border-color: #78350f !important; }
        .type-fairy { background-color: #701a75 !important; border-color: #86198f !important; }
        .type-fighting { background-color: #7c2d12 !important; border-color: #9a3412 !important; }
        .type-psychic { background-color: #831843 !important; border-color: #9d174d !important; }
        .type-rock { background-color: #422006 !important; border-color: #5d2b06 !important; }
        .type-ghost { background-color: #2e1065 !important; border-color: #4c1d95 !important; }
        .type-ice { background-color: #164e63 !important; border-color: #155e75 !important; }
        .type-dragon { background-color: #1e1b4b !important; border-color: #312e81 !important; }
        .type-steel { background-color: #1e293b !important; border-color: #334155 !important; }
        .type-dark { background-color: #475569 !important; border-color: #64748b !important; }
        .type-flying { background-color: #312e81 !important; border-color: #3730a3 !important; }

        #missing-modal, #confirm-modal { backdrop-filter: blur(8px); }
        .text-shadow { text-shadow: 0 1px 2px rgba(0,0,0,0.8); }

        .box-complete-badge, .pkmn-complete-badge {
            animation: badge-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes badge-in {
            from { transform: scale(0.8) translateY(-5px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <header class="sticky-header sticky top-0 z-50 px-4 py-6 mb-10">
        <div class="max-w-[1700px] mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <div class="flex flex-wrap items-center gap-4">
                    <h1 class="text-3xl font-black bg-gradient-to-r from-purple-400 via-white to-pink-500 bg-clip-text text-transparent uppercase tracking-tighter">
                        LEGENDS Z-A: MEGA DIMENSION TRACKER
                    </h1>
                    <a href="https://kampootee.github.io/pokedex/za/" class="bg-pink-600 text-white px-4 py-1 rounded-xl font-black text-sm uppercase tracking-tighter hover:bg-pink-500 transition-all shadow-lg active:scale-95 inline-block">
                        Base Game Pokédex
                    </a>
                </div>
                <div id="save-status" class="text-[10px] font-black uppercase tracking-widest text-slate-500 mt-2 md:mt-0 transition-opacity opacity-0">
                    <span class="inline-block w-2 h-2 rounded-full bg-emerald-500 mr-2"></span>Synced to Browser
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                <div onclick="showMissing('reg')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-blue-500/20 shadow-lg hover:border-blue-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-blue-400 uppercase tracking-widest block mb-0.5">DLC Dex</span><span class="text-sm font-bold text-white uppercase tracking-tight">Registered</span></div>
                        <span class="text-xl font-black text-shadow text-blue-400" id="reg-stats">0 / 132</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="reg-bar" class="bg-gradient-to-r from-blue-600 to-blue-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-blue-400/30 group-hover:text-blue-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ?</div>
                </div>

                <div onclick="showMissing('living')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-amber-500/20 shadow-lg hover:border-amber-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-amber-400 uppercase tracking-widest block mb-0.5">DLC Storage</span><span class="text-sm font-bold text-white uppercase tracking-tight">Living Dex</span></div>
                        <span class="text-xl font-black text-shadow text-amber-400" id="living-stats">0 / 132</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="living-bar" class="bg-gradient-to-r from-amber-600 to-amber-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-amber-400/30 group-hover:text-amber-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ?</div>
                </div>

                <div onclick="showMissing('alpha')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-red-500/20 shadow-lg hover:border-red-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-red-400 uppercase tracking-widest block mb-0.5">DLC Alpha</span><span class="text-sm font-bold text-white uppercase tracking-tight">Alpha</span></div>
                        <span class="text-xl font-black text-shadow text-red-400" id="alpha-stats">0 / 112</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="alpha-bar" class="bg-gradient-to-r from-red-600 to-red-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-blue-400/30 group-hover:text-blue-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ?</div>
                </div>

                <div onclick="showMissing('mega')" class="group cursor-pointer bg-slate-900/80 p-4 rounded-2xl border border-emerald-500/20 shadow-lg hover:border-emerald-500/5 transition-all">
                    <div class="flex justify-between items-end mb-2">
                        <div><span class="text-[9px] font-black text-emerald-400 uppercase tracking-widest block mb-0.5">DLC Megas</span><span class="text-sm font-bold text-white uppercase tracking-tight">Mega Forms</span></div>
                        <span class="text-xl font-black text-shadow text-emerald-400" id="mega-stats">0 / 22</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden"><div id="mega-bar" class="bg-gradient-to-r from-emerald-600 to-emerald-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div></div>
                    <div class="mt-2 text-[8px] font-black text-emerald-400/30 group-hover:text-emerald-400/70 uppercase tracking-widest text-right italic transition-colors">View Missing ?</div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-[1700px] mx-auto px-6">
        <div id="pokedex-container" class="flex flex-col gap-16 items-center"></div>
        <div class="mt-20 flex flex-col items-center gap-4 text-center">
            <button onclick="promptReset()" class="px-10 py-4 bg-slate-900 hover:bg-red-600 hover:text-white text-slate-500 border border-slate-800 rounded-2xl transition-all duration-300 text-sm font-black uppercase tracking-widest">
                Hyperspace Reset: Clear DLC Data
            </button>
        </div>
    </main>

    <!-- Missing Items Modal -->
    <div id="missing-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/60">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-2xl max-h-[85vh] rounded-[2.5rem] shadow-2xl flex flex-col overflow-hidden">
            <div class="p-8 border-b border-slate-700 flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl font-black uppercase tracking-tighter italic">Missing Specimens</h2>
                <button onclick="closeModal()" class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-red-600 rounded-full transition-colors font-black">?</button>
            </div>
            <div id="modal-content" class="p-8 overflow-y-auto grid grid-cols-2 md:grid-cols-3 gap-3"></div>
        </div>
    </div>

    <!-- Confirm Reset Modal -->
    <div id="confirm-modal" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-4 bg-black/80">
        <div class="bg-slate-900 border border-red-500/50 w-full max-w-md rounded-[2rem] shadow-2xl p-8 text-center">
            <h2 class="text-2xl font-black uppercase tracking-tighter text-red-500 mb-4">Confirm Reset</h2>
            <p class="text-slate-400 text-sm mb-8 font-bold">Wipe your Mega Dimension progress?</p>
            <div class="flex gap-4">
                <button onclick="resetTracker()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-black py-4 rounded-xl uppercase text-xs tracking-widest transition-all">Yes, Reset</button>
                <button onclick="closeConfirm()" class="flex-1 bg-slate-800 hover:bg-slate-700 text-white font-black py-4 rounded-xl uppercase text-xs tracking-widest transition-all">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * STORAGE_KEY is fixed to prevent data loss across design updates.
         * Current: 'legends_za_mega_dimension_storage_v3_persistent'
         */
        const STORAGE_KEY = 'legends_za_mega_dimension_storage_v3_persistent';
        const PKMN_PER_BOX = 30;
        
        const NO_ALPHA_NAMES = [
            "Heatran", "Volcanion", "Cobalion", "Terrakion", "Virizion", "Keldeo", "Meloetta", "Genesect", "Hoopa", "Marshadow", "Meltan", "Melmetal", "Darkrai", "Latias", "Latios", "Kyogre", "Groudon", "Rayquaza", "Magearna", "Zeraora"
        ];

        const MEGA_DIMENSION_MEGAS = {
            15: 1, 21: 1, 31: 1, 34: 1, 41: 1, 44: 1, 47: 1, 51: 1, 63: 1, 72: 1, 83: 1, 88: 1, 113: 1, 121: 1, 125: 1, 126: 1, 127: 1, 128: 1, 129: 1, 130: 1, 131: 1, 132: 1
        };

        const POKEMON_DATA = [
            { dlc: 1, name: "Mankey", id: 56, type: "fighting" },
            { dlc: 2, name: "Primeape", id: 57, type: "fighting" },
            { dlc: 3, name: "Annihilape", id: 979, type: "fighting" },
            { dlc: 4, name: "Meowth", id: 52, type: "normal" },
            { dlc: 5, name: "Persian", id: 53, type: "normal" },
            { dlc: 6, name: "Perrserker", id: 863, type: "steel" },
            { dlc: 7, name: "Farfetch'd", id: 83, type: "normal" },
            { dlc: 8, name: "Sirfetch'd", id: 865, type: "fighting" },
            { dlc: 9, name: "Cubone", id: 104, type: "ground" },
            { dlc: 10, name: "Marowak", id: 105, type: "ground" },
            { dlc: 11, name: "Porygon", id: 137, type: "normal" },
            { dlc: 12, name: "Porygon2", id: 233, type: "normal" },
            { dlc: 13, name: "Porygon-Z", id: 474, type: "normal" },
            { dlc: 14, name: "Capsakid", id: 951, type: "grass" },
            { dlc: 15, name: "Scovillain", id: 952, type: "grass" },
            { dlc: 16, name: "Tinkatink", id: 957, type: "fairy" },
            { dlc: 17, name: "Tinkatuff", id: 958, type: "fairy" },
            { dlc: 18, name: "Tinkaton", id: 959, type: "fairy" },
            { dlc: 19, name: "Cyclizar", id: 967, type: "dragon" },
            { dlc: 20, name: "Glimmet", id: 969, type: "rock" },
            { dlc: 21, name: "Glimmora", id: 970, type: "rock" },
            { dlc: 22, name: "Rotom", id: 479, type: "electric" },
            { dlc: 23, name: "Greavard", id: 971, type: "ghost" },
            { dlc: 24, name: "Houndstone", id: 972, type: "ghost" },
            { dlc: 25, name: "Sandygast", id: 769, type: "ghost" },
            { dlc: 26, name: "Palossand", id: 770, type: "ghost" },
            { dlc: 27, name: "Kecleon", id: 352, type: "normal" },
            { dlc: 28, name: "Flamigo", id: 973, type: "flying" },
            { dlc: 29, name: "Cryogonal", id: 615, type: "ice" },
            { dlc: 30, name: "Dondozo", id: 977, type: "water" },
            { dlc: 31, name: "Tatsugiri", id: 978, type: "dragon" },
            { dlc: 32, name: "Frigibax", id: 996, type: "dragon" },
            { dlc: 33, name: "Arctibax", id: 997, type: "dragon" },
            { dlc: 34, name: "Baxcalibur", id: 998, type: "dragon" },
            { dlc: 35, name: "Gimmighoul", id: 999, type: "ghost" },
            { dlc: 36, name: "Gholdengo", id: 1000, type: "steel" },
            { dlc: 37, name: "Qwilfish", id: 211, type: "water" },
            { dlc: 38, name: "Overqwil", id: 904, type: "dark" },
            { dlc: 39, name: "Treecko", id: 252, type: "grass" },
            { dlc: 40, name: "Grovyle", id: 253, type: "grass" },
            { dlc: 41, name: "Sceptile", id: 254, type: "grass" },
            { dlc: 42, name: "Torchic", id: 255, type: "fire" },
            { dlc: 43, name: "Combusken", id: 256, type: "fire" },
            { dlc: 44, name: "Blaziken", id: 257, type: "fire" },
            { dlc: 45, name: "Mudkip", id: 258, type: "water" },
            { dlc: 46, name: "Marshtomp", id: 259, type: "water" },
            { dlc: 47, name: "Swampert", id: 260, type: "water" },
            { dlc: 48, name: "Feebas", id: 349, type: "water" },
            { dlc: 49, name: "Milotic", id: 350, type: "water" },
            { dlc: 50, name: "Chingling", id: 433, type: "psychic" },
            { dlc: 51, name: "Chimecho", id: 358, type: "psychic" },
            { dlc: 52, name: "Indeedee", id: 876, type: "psychic" },
            { dlc: 53, name: "Purrloin", id: 509, type: "dark" },
            { dlc: 54, name: "Liepard", id: 510, type: "dark" },
            { dlc: 55, name: "Munna", id: 517, type: "psychic" },
            { dlc: 56, name: "Musharna", id: 518, type: "psychic" },
            { dlc: 57, name: "Throh", id: 538, type: "fighting" },
            { dlc: 58, name: "Sawk", id: 539, type: "fighting" },
            { dlc: 59, name: "Yamask", id: 562, type: "ghost" },
            { dlc: 60, name: "Cofagrigus", id: 563, type: "ghost" },
            { dlc: 61, name: "Runerigus", id: 867, type: "ground" },
            { dlc: 62, name: "Wimpod", id: 767, type: "bug" },
            { dlc: 63, name: "Golisopod", id: 768, type: "bug" },
            { dlc: 64, name: "Nickit", id: 827, type: "dark" },
            { dlc: 65, name: "Thievul", id: 828, type: "dark" },
            { dlc: 66, name: "Clobbopus", id: 852, type: "fighting" },
            { dlc: 67, name: "Grapploct", id: 853, type: "fighting" },
            { dlc: 68, name: "Mimikyu", id: 778, type: "ghost" },
            { dlc: 69, name: "Kleavor", id: 900, type: "bug" },
            { dlc: 70, name: "Morpeko", id: 877, type: "electric" },
            { dlc: 71, name: "Golett", id: 622, type: "ground" },
            { dlc: 72, name: "Golurk", id: 623, type: "ground" },
            { dlc: 73, name: "Rookidee", id: 821, type: "flying" },
            { dlc: 74, name: "Corvisquire", id: 822, type: "flying" },
            { dlc: 75, name: "Corviknight", id: 823, type: "flying" },
            { dlc: 76, name: "Igglybuff", id: 174, type: "fairy" },
            { dlc: 77, name: "Jigglypuff", id: 39, type: "fairy" },
            { dlc: 78, name: "Wigglytuff", id: 40, type: "fairy" },
            { dlc: 79, name: "Fidough", id: 926, type: "fairy" },
            { dlc: 80, name: "Dachsbun", id: 927, type: "fairy" },
            { dlc: 81, name: "Starly", id: 396, type: "flying" },
            { dlc: 82, name: "Staravia", id: 397, type: "flying" },
            { dlc: 83, name: "Staraptor", id: 398, type: "flying" },
            { dlc: 84, name: "Spoink", id: 322, type: "psychic" },
            { dlc: 85, name: "Grumpig", id: 323, type: "psychic" },
            { dlc: 86, name: "Squawkabilly", id: 931, type: "normal" },
            { dlc: 87, name: "Crabrawler", id: 739, type: "fighting" },
            { dlc: 88, name: "Crabominable", id: 740, type: "fighting" },
            { dlc: 89, name: "Nacli", id: 932, type: "rock" },
            { dlc: 90, name: "Naclstack", id: 933, type: "rock" },
            { dlc: 91, name: "Garganacl", id: 934, type: "rock" },
            { dlc: 92, name: "Gulpin", id: 316, type: "poison" },
            { dlc: 93, name: "Swalot", id: 317, type: "poison" },
            { dlc: 94, name: "Zubat", id: 41, type: "poison" },
            { dlc: 95, name: "Golbat", id: 42, type: "poison" },
            { dlc: 96, name: "Crobat", id: 169, type: "poison" },
            { dlc: 97, name: "Charcadet", id: 935, type: "fire" },
            { dlc: 98, name: "Armarouge", id: 936, type: "fire" },
            { dlc: 99, name: "Ceruledge", id: 937, type: "fire" },
            { dlc: 100, name: "Maschiff", id: 942, type: "dark" },
            { dlc: 101, name: "Mabosstiff", id: 943, type: "dark" },
            { dlc: 102, name: "Toxel", id: 848, type: "electric" },
            { dlc: 103, name: "Toxtricity", id: 849, type: "electric" },
            { dlc: 104, name: "Shroodle", id: 944, type: "poison" },
            { dlc: 105, name: "Grafaiai", id: 945, type: "poison" },
            { dlc: 106, name: "Zangoose", id: 335, type: "normal" },
            { dlc: 107, name: "Seviper", id: 336, type: "poison" },
            { dlc: 108, name: "Mime Jr.", id: 439, type: "psychic" },
            { dlc: 109, name: "Mr. Mime", id: 122, type: "psychic" },
            { dlc: 110, name: "Mr. Rime", id: 866, type: "ice" },
            { dlc: 111, name: "Foongus", id: 590, type: "grass" },
            { dlc: 112, name: "Amoonguss", id: 591, type: "grass" },
            { dlc: 113, name: "Heatran", id: 485, type: "fire" },
            { dlc: 114, name: "Volcanion", id: 721, type: "fire" },
            { dlc: 115, name: "Cobalion", id: 638, type: "steel" },
            { dlc: 116, name: "Terrakion", id: 639, type: "rock" },
            { dlc: 117, name: "Virizion", id: 640, type: "grass" },
            { dlc: 118, name: "Keldeo", id: 647, type: "water" },
            { dlc: 119, name: "Meloetta", id: 648, type: "normal" },
            { dlc: 120, name: "Genesect", id: 649, type: "bug" },
            { dlc: 121, name: "Hoopa", id: 720, type: "psychic" },
            { dlc: 122, name: "Marshadow", id: 802, type: "fighting" },
            { dlc: 123, name: "Meltan", id: 808, type: "steel" },
            { dlc: 124, name: "Melmetal", id: 809, type: "steel" },
            { dlc: 125, name: "Darkrai", id: 491, type: "dark" },
            { dlc: 126, name: "Latias", id: 380, type: "dragon" },
            { dlc: 127, name: "Latios", id: 381, type: "dragon" },
            { dlc: 128, name: "Kyogre", id: 382, type: "water" },
            { dlc: 129, name: "Groudon", id: 383, type: "ground" },
            { dlc: 130, name: "Rayquaza", id: 384, type: "dragon" },
            { dlc: 131, name: "Magearna", id: 801, type: "steel" },
            { dlc: 132, name: "Zeraora", id: 807, type: "electric" }
        ];

        const TOTAL_PKMN = 132;
        const TOTAL_MEGAS = Object.keys(MEGA_DIMENSION_MEGAS).length;

        const container = document.getElementById('pokedex-container');
        const saveStatusEl = document.getElementById('save-status');

        function init() {
            container.innerHTML = '';
            let currentIdx = 0;
            let boxNum = 1;
            while (currentIdx < TOTAL_PKMN) {
                const start = currentIdx + 1;
                const end = Math.min(currentIdx + PKMN_PER_BOX, TOTAL_PKMN);
                createBox(boxNum, start, end, currentIdx);
                currentIdx += PKMN_PER_BOX;
                boxNum++;
            }
            loadProgress();
            updateStats(false);
        }

        function createBox(number, start, end, dataIdx) {
            const boxCard = document.createElement('div');
            boxCard.className = 'box-card p-8 rounded-[2.5rem] w-full max-w-[1400px] relative overflow-hidden mb-12';
            boxCard.id = `box-container-${number}`;
            
            boxCard.innerHTML = `
                <div class="flex items-baseline justify-between mb-8 border-b border-slate-700/50 pb-5">
                    <div class="flex items-baseline gap-4">
                        <span class="bg-purple-600 text-white px-4 py-1 rounded-xl font-black text-sm uppercase tracking-tighter">Box ${number}</span>
                        <span class="text-white font-black text-xl tracking-tight">#${String(start).padStart(3, '0')} — #${String(end).padStart(3, '0')}</span>
                    </div>
                    <div id="box-complete-${number}" class="hidden box-complete-badge bg-emerald-500 text-white px-4 py-1 rounded-xl font-black text-sm uppercase tracking-widest shadow-lg shadow-emerald-500/20">
                        Box Stabilized!
                    </div>
                </div>
                <div class="pokemon-grid" id="box-grid-${number}"></div>
            `;
            container.appendChild(boxCard);
            const grid = document.getElementById(`box-grid-${number}`);

            for (let i = dataIdx; i < dataIdx + (end - start + 1); i++) {
                if (i >= POKEMON_DATA.length) break;
                const p = POKEMON_DATA[i];
                const dlcNum = p.dlc;
                const megaExists = MEGA_DIMENSION_MEGAS[dlcNum];
                
                const item = document.createElement('div');
                item.id = `pkmn-cell-${dlcNum}`;
                item.className = `group pkmn-cell flex flex-col p-4 rounded-2xl border-2 transition-all duration-300 type-${p.type}`;
                item.style.backgroundImage = `url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${p.id}.png')`;

                let megaHtml = '';
                if (megaExists) {
                    let label = "Mega";
                    if ([128, 129].includes(dlcNum)) label = "Primal";
                    if (dlcNum === 121) label = "Unbound";
                    megaHtml = `<label class="track-btn btn-mega"><input type="checkbox" id="mega-${dlcNum}-0">${label}</label>`;
                }

                let alphaHtml = '';
                if (!NO_ALPHA_NAMES.includes(p.name)) {
                    alphaHtml = `<label class="track-btn btn-alpha"><input type="checkbox" id="alpha-${dlcNum}">Alpha</label>`;
                }

                item.innerHTML = `
                    <div class="flex items-center justify-between mb-2 min-h-[24px]">
                        <div class="flex items-baseline gap-2">
                            <span class="text-[10px] font-black text-white/50 tracking-wider text-shadow">#${String(dlcNum).padStart(3, '0')}</span>
                            <span class="pkmn-name text-sm font-bold text-white group-hover:scale-105 transition-transform origin-left text-shadow">${p.name}</span>
                        </div>
                        <div id="pkmn-complete-${dlcNum}" class="hidden pkmn-complete-badge bg-emerald-500 text-white w-5 h-5 flex items-center justify-center rounded-full shadow-lg">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 bg-black/40 p-2 rounded-xl border border-white/5 backdrop-blur-sm relative z-10">
                        <label class="track-btn btn-reg"><input type="checkbox" id="reg-${dlcNum}">Registered</label>
                        <label class="track-btn btn-living"><input type="checkbox" id="living-${dlcNum}">Living</label>
                        ${alphaHtml}
                        ${megaHtml}
                    </div>
                `;
                grid.appendChild(item);
            }
        }

        function showMissing(category) {
            const modal = document.getElementById('missing-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            content.innerHTML = '';
            let missingItems = [];
            
            title.innerText = `Missing: ${category.toUpperCase()} Collection`;
            
            for (let i = 0; i < TOTAL_PKMN; i++) {
                const p = POKEMON_DATA[i];
                const dlcNum = p.dlc;
                if (category !== 'mega') {
                    if (category === 'alpha' && NO_ALPHA_NAMES.includes(p.name)) continue;
                    const cb = document.getElementById(`${category}-${dlcNum}`);
                    if (cb && !cb.checked) missingItems.push({ id: dlcNum, name: p.name, type: p.type });
                } else {
                    if (MEGA_DIMENSION_MEGAS[dlcNum]) {
                        const cb = document.getElementById(`mega-${dlcNum}-0`);
                        if (cb && !cb.checked) {
                             let label = "Mega";
                             if ([128, 129].includes(dlcNum)) label = "Primal";
                             if (dlcNum === 121) label = "Unbound";
                             missingItems.push({ id: dlcNum, name: `${label} ${p.name}`, type: p.type });
                        }
                    }
                }
            }
            if (missingItems.length === 0) {
                content.innerHTML = `<div class="col-span-full py-20 text-center font-black text-emerald-400 uppercase tracking-widest text-xl">Dimension Complete!</div>`;
            } else {
                missingItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = `p-3 rounded-xl border-2 type-${item.type} bg-opacity-40 flex items-center gap-3`;
                    div.innerHTML = `<span class="text-[10px] font-black text-white/40">#${String(item.id).padStart(3, '0')}</span><span class="text-sm font-bold text-white">${item.name}</span>`;
                    content.appendChild(div);
                });
            }
        }

        function closeModal() { document.getElementById('missing-modal').classList.add('hidden'); }
        function promptReset() { document.getElementById('confirm-modal').classList.remove('hidden'); }
        function closeConfirm() { document.getElementById('confirm-modal').classList.add('hidden'); }

        function updateStats(showFeedback = true) {
            const r = document.querySelectorAll('.btn-reg input:checked').length;
            const l = document.querySelectorAll('.btn-living input:checked').length;
            const a = document.querySelectorAll('.btn-alpha input:checked').length;
            const m = document.querySelectorAll('.btn-mega input:checked').length;
            
            const alphaTotal = POKEMON_DATA.filter(p => !NO_ALPHA_NAMES.includes(p.name)).length;

            document.getElementById('reg-stats').innerText = `${r} / ${TOTAL_PKMN}`;
            document.getElementById('living-stats').innerText = `${l} / ${TOTAL_PKMN}`;
            document.getElementById('alpha-stats').innerText = `${a} / ${alphaTotal}`;
            document.getElementById('mega-stats').innerText = `${m} / ${TOTAL_MEGAS}`;
            
            document.getElementById('reg-bar').style.width = (r/TOTAL_PKMN*100)+'%';
            document.getElementById('living-bar').style.width = (l/TOTAL_PKMN*100)+'%';
            document.getElementById('alpha-bar').style.width = (a/alphaTotal*100)+'%';
            document.getElementById('mega-bar').style.width = (TOTAL_MEGAS > 0 ? (m / TOTAL_MEGAS * 100) : 0) + '%';
            
            // Individual Badges
            for (let i = 0; i < TOTAL_PKMN; i++) {
                const p = POKEMON_DATA[i];
                const dlcNum = p.dlc;
                const cell = document.getElementById(`pkmn-cell-${dlcNum}`);
                const badge = document.getElementById(`pkmn-complete-${dlcNum}`);
                if (cell && badge) {
                    const inputs = cell.querySelectorAll('input');
                    const checked = cell.querySelectorAll('input:checked');
                    if (inputs.length > 0 && inputs.length === checked.length) {
                        badge.classList.remove('hidden');
                        cell.style.borderColor = 'rgba(16, 185, 129, 0.6)';
                    } else {
                        badge.classList.add('hidden');
                        cell.style.borderColor = '';
                    }
                }
            }

            // Box Badges
            const totalBoxes = Math.ceil(TOTAL_PKMN / PKMN_PER_BOX);
            for (let b = 1; b <= totalBoxes; b++) {
                const boxGrid = document.getElementById(`box-grid-${b}`);
                const badge = document.getElementById(`box-complete-${b}`);
                if (boxGrid && badge) {
                    const inputs = boxGrid.querySelectorAll('input');
                    const checkedInputs = boxGrid.querySelectorAll('input:checked');
                    if (inputs.length > 0 && inputs.length === checkedInputs.length) {
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            }
            saveProgress(showFeedback);
        }

        // --- Persistent Storage Logic ---
        function saveProgress(showFeedback) {
            const state = {};
            document.querySelectorAll('input[type="checkbox"]').forEach(input => { 
                if (input.checked) state[input.id] = true; 
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            
            if (showFeedback) {
                saveStatusEl.style.opacity = '1';
                setTimeout(() => { saveStatusEl.style.opacity = '0'; }, 1500);
            }
        }

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;
            try {
                const state = JSON.parse(saved);
                Object.keys(state).forEach(id => { 
                    const input = document.getElementById(id); 
                    if (input) input.checked = true; 
                });
                updateStats(false);
            } catch(e) { 
                console.error("Critical: Storage recovery failed", e); 
            }
        }

        function resetTracker() {
            localStorage.removeItem(STORAGE_KEY);
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            updateStats(false);
            closeConfirm();
        }

        // Global Event Listeners
        document.addEventListener('change', (e) => { 
            if (e.target.type === 'checkbox') updateStats(true); 
        });

        window.onclick = function(e) { 
            if (e.target == document.getElementById('missing-modal')) closeModal(); 
            if (e.target == document.getElementById('confirm-modal')) closeConfirm();
        }

        window.onload = init;
    </script>
</body>
</html>
